
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6.1. Phương pháp chuyên gia và mô hình &#8212; Deep AI KhanhBlog</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"TeX": {"Macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://phamdinhkhanh.github.io/deepai-book/ch_ml/creditScorecard.html" />
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Giới thiệu về SVM" href="index_SVM.html" />
    <link rel="prev" title="6. Ứng dụng mô hình scorecard" href="index_creditScorecard.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/ML_course_logos.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Deep AI KhanhBlog</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Lời nói đầu
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Giới thiệu
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../contents.html">
   Các chương dự kiến
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch_intro/main_contents.html">
   Mục tiêu cuốn sách
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../latex.html">
   Latex
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../grossary.html">
   Bảng thuật ngữ
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Phụ lục
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/appendix_dtypes.html">
   1. Định dạng dữ liệu
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_dtypes_basic.html">
     1.1. Các định dạng số, boolean và ký tự
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/index_pandas.html">
   2. Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_pandas.html">
     2.1. Khởi tạo dataframe
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/index_numpy.html">
   3. Numpy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_numpy.html">
     3.1. Khởi tạo một mảng trên numpy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/index_matplotlib.html">
   4. Matplotlib
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_matplotlib.html">
     4.1. Format chung của một biểu đồ trên matplotlib
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/index_OOP.html">
   5. Lập trình hướng đối tượng (Object Oriented Programming - OOP)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_OOP.html">
     5.1. Class và Object
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/index_pipeline.html">
   6. Sklearn Pipeline
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_pipeline.html">
     6.1. Thiết kế pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch_appendix/index_Convex_Opt.html">
   7. Giới thiệu chung về optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch_appendix/appendix_Convex_Opt.html">
     7.1. Bài toán dạng tổng quát
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Đại số tuyến tính
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ch_algebra/appendix_algebra.html">
   1. Đại số tuyến tính
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Giới thiệu
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ch_calculus/appendix_calculus.html">
   1. Giải tích tích phân
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Xác suất
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ch_probability/appendix_probability.html">
   1. Xác suất
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index_MLIntroduce.html">
   1. Khái quát Machine Learning
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_prediction.html">
   2. Bài toán dự báo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="prediction.html">
     2.1. Ứng dụng của hồi qui tuyến tính
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_RidgedRegression.html">
   2.2. Hồi qui Ridge và Lasso
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="RidgedRegression.html">
     2.2.2. Hồi qui Ridge
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_classification.html">
   3. Bài toán phân loại
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="classification.html">
     3.1. Hồi qui Logistic
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_OvfAndUdf.html">
   4. Độ chệch (
   <em>
    bias
   </em>
   ) và phương sai (
   <em>
    variance
   </em>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="OvfAndUdf.html">
     4.1. Sự đánh đổi giữa độ chệch và phương sai
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_ModelMetric.html">
   5. Thước đo mô hình phân loại
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="modelMetric.html">
     5.1. Bộ dữ liệu
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index_creditScorecard.html">
   6. Ứng dụng mô hình scorecard
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     6.1. Phương pháp chuyên gia và mô hình
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_SVM.html">
   7. Giới thiệu về SVM
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="SVM.html">
     7.1. Hàm mất mát của SVM
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_DecisionTree.html">
   8. Khái niệm về cây quyết định
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="DecisionTree.html">
     8.1. Mô hình cây quyết định (
     <em>
      decision tree
     </em>
     )
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_RandomForest.html">
   9. Giới thiệu về mô hình rừng cây (
   <em>
    Random Forest
   </em>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="RandomForest.html">
     9.1. Ý tưởng của mô hình rừng cây
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_Bayes.html">
   10. Bạn là
   <em>
    Tần suất
   </em>
   (
   <em>
    Frequentist
   </em>
   ) hay
   <em>
    Bayesian
   </em>
   ?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="NaiveBayes.html">
     10.1. Ước lượng hợp lý tối đa (
     <em>
      Maximum Likelihood Function - MLE
     </em>
     )
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_FeatureEngineering.html">
   11. Giới thiệu về feature engineering
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="FeatureEngineering.html">
     11.1. Feature Engineering
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_Boosting.html">
   12. Phương pháp tăng cường (
   <em>
    Boosting
   </em>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Boosting.html">
     12.1. AdaBoosting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_KMeans.html">
   13. k-Means Clustering
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="KMeans.html">
     13.1. Các bước của thuật toán k-Means Clustering
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_HierarchicalClustering.html">
   14. Hierarchical Clustering (
   <em>
    phân cụm phân cấp
   </em>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="HierarchicalClustering.html">
     14.1. Chiến lược hợp nhất (
     <em>
      agglomerative
     </em>
     )
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_DBSCAN.html">
   15. DBSCAN
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="DBSCAN.html">
     15.1. Phương pháp phân cụm dựa trên mật độ (
     <em>
      Density-Based Clustering
     </em>
     )
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_GMM.html">
   16. Gaussian Mixture Model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="GMM.html">
     16.1. Ước lượng MLE cho
     <em>
      phân phối Gaussian đa chiều
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="index_PCA.html">
   17. Giảm chiều dữ liệu
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="PCA.html">
     17.1. Phương pháp phân tích suy biến
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Đóng góp từ những tác giả khác
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ch_donation/fubini_and_riemann.html">
   Tích phân Riemann và định lý Fubini
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ch_donation/information_theory.html">
   Lý thuyết thông tin
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/ch_ml/creditScorecard.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/ch_ml/creditScorecard.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/phamdinhkhanh/deepai-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/phamdinhkhanh/deepai-book/issues/new?title=Issue%20on%20page%20%2Fch_ml/creditScorecard.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/phamdinhkhanh/deepai-book/edit/main/book/ch_ml/creditScorecard.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phamdinhkhanh/deepai-book/main?urlpath=tree/book/ch_ml/creditScorecard.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   6.1. Phương pháp chuyên gia và mô hình
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#xay-dung-mo-hinh-credit-scorecard">
   6.2. Xây dựng mô hình credit scorecard
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weight-of-evidence-woe">
     6.2.1. Weight of Evidence - WOE
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uu-va-nhuoc-diem-cua-phuong-phap-woe">
     6.2.2. Ưu và nhược điểm của phương pháp WOE
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tieu-chuan-mo-hinh-scorecard">
     6.2.3. Tiêu chuẩn mô hình scorecard
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xay-dung-model-scorecard">
     6.2.4.  Xây dựng model ScoreCard
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#khao-sat-du-lieu">
       6.2.4.1. Khảo sát dữ liệu
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ap-dung-phuong-phap-woe">
       6.2.4.2. Áp dụng phương pháp WOE
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#xep-hang-cac-bien-theo-suc-manh-du-bao">
       6.2.4.3. Xếp hạng các biến theo sức mạnh dự báo
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#hoi-qui-logistic">
       6.2.4.4. Hồi qui logistic
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tinh-diem-credit-score-cho-moi-dac-trung">
       6.2.4.5. Tính điểm credit score cho mỗi đặc trưng
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ket-luan">
     6.3. Kết luận
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bai-tap">
     6.4. Bài tập
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tai-lieu-tham-khao">
     6.5. Tài liệu tham khảo
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="phuong-phap-chuyen-gia-va-mo-hinh">
<h1>6.1. Phương pháp chuyên gia và mô hình<a class="headerlink" href="#phuong-phap-chuyen-gia-va-mo-hinh" title="Permalink to this headline">¶</a></h1>
<p>Để đánh giá rủi ro tín dụng chúng ta có thể áp dụng phương pháp chuyên gia hoặc sử dụng mô hình thống kê. Mỗi phương pháp đều có các ưu nhược điểm khác nhau. Tiếp theo chúng ta sẽ cùng nhau phân biệt hai phương pháp này:</p>
<p><strong>Phương pháp chuyên gia</strong>: Như tên gọi của nó, phương pháp chuyên gia sẽ dựa trên ý kiến thẩm định của các chuyên gia về rủi ro đối với một khoản tín dụng. Rủi ro sẽ được căn cứ trên các thông tin chủ yếu đó là:</p>
<ul class="simple">
<li><p>Đặc điểm của chủ thể vay (character): Thẩm định danh tiếng, tính trung thực của người vay vốn.</p></li>
<li><p>Vốn (capital): Thẩm định sự chênh lệch giữa tài sản và nguồn vốn của người cho vay. Tài sản chính là những giá trị mà ngân hàng có thể thu hồi khi người vay không trả được nợ. Nguồn vốn có thể là các chi phí mà người vay đang phải chi trả như chi tiêu gia đình, chi phí sinh hoạt, chi phí trả lãi từ các khoản vay khác,…. Sau khi trừ đi các chi phí chúng ta sẽ biết được giá trị khả dụng của người vay và liệu nó có đủ để bao quát lãi vay hay không?</p></li>
<li><p>Tài sản đảm bảo (collateral): Sẽ có 2 loại hình thức cho vay được phân chia dựa trên tài sản đảm bảo đó là vay thế chấp (có tài sản đảm bảo) và vay tín chấp (không có tài sản đảm bảo). Rủi ro của 2 hình thức cho vay này là khác biệt nhau nên lãi suất và hạn mức của chúng cũng sẽ khác biệt để đảm bảo dung hòa giữa lợi nhuận và rủi ro đối với ngân hàng. Đối với vay thế chấp ngân hàng sẽ phải định giá chính xác giá trị của các tài sản thế chấp. Gía trị các tài sản này sẽ quyết định hạn mức tín dụng mà ngân hàng sẽ cấp cho người vay. Rủi ro đối với các khoản vay thế chấp là thấp hơn tín chấp vì trong trường hợp khách hàng không có khả năng thanh toán, ngân hàng được quyền thu hồi tài sản đảm bảo.</p></li>
<li><p>Khả năng trả nợ (capacity): Là các thông tin liên quan trực tiếp đến khả năng tài chính của người vay đó là: nghề nghiệp, mức thu nhập, trạng thái hôn nhân, số người phụ thuộc,….</p></li>
<li><p>Điều kiện (condition): Đánh giá sơ bộ trạng thái của người vay có tham chiếu tới điều kiện thị trường, bối cảnh tài chính, áp lực cạnh tranh, mục đích sử dụng vốn,…. Chẳng hạn người vay là hộ dân trồng cafe nhưng năm vừa qua thị trường cafe giảm giá mạnh. Do đó sẽ khiến lợi nhuận và khả năng thanh toán của người vay xuống thấp hơn dự kiến.</p></li>
</ul>
<p>Phương pháp chuyên gia là phương pháp thủ công vì nó dựa trên kinh nghiệm của con người. Do đó quá trình thẩm định sẽ tốn kém về thời gian. Đồng thời ý kiến đánh giá cũng không nhất quán giữa các chuyên gia. Do đó một phương pháp khác được khuyến nghị phát triển ở hội nghị basel nhằm đưa ra các đánh giá nhanh chóng và nhất quán hơn. Đó chính là phương pháp mô hình.</p>
<p><strong>Phương pháp mô hình</strong>: Phương pháp mô hình sẽ dựa trên điểm số được lượng hóa từ mô hình học máy. Phương pháp này có nhiều điểm tối ưu hơn so với phương pháp chuyên gia:</p>
<ul class="simple">
<li><p>Những mô hình đưa ra kết quả dường như là ngay lập tức. Do đó thời gian thẩm định hồ sơ nhanh chóng và rất phù hợp với các nền tảng cho vay online.</p></li>
<li><p>Năng suất thẩm định từ mô hình cao hơn rất nhiều so với các chuyên gia. Một môt hình có thể giải quyết số lượng hồ sơ bằng khối lượng công việc của hàng trăm chuyên gia.</p></li>
<li><p>Giảm thiểu chi phí lao động khi không phải chi trả lương cho các chuyên gia thẩm định.</p></li>
<li><p>Kết quả đánh giá hồ sơ là rất nhất quán dựa trên điểm số tín nhiệm là duy nhất, trong khi đó các chuyên gia có thể đưa ra kết quả đánh giá khác nhau dựa trên cảm quan của họ về rủi ro. Khi xảy ra bất đồng ý kiến, sẽ cần hội đồng chuyên gia đánh giá lại hồ sơ và khá tốn thời gian để hoàn thành thẩm định.</p></li>
<li><p>Mô hình sẽ xem xét toàn diện các biến số đầu vào và thậm chí có thể gia tăng số lượng biến tùy ý mà không ảnh hưởng tới thời gian dự báo. Trong khi phương pháp chuyên gia sẽ chịu hạn chế bởi khả năng của con người là có hạn. Việc đánh giá hồ sơ đôi khi chỉ được nhận định trên một số biến chính.</p></li>
</ul>
<p>Chính vì những lợi thế đó, phương pháp mô hình đang dần thay thế phương pháp chuyên gia và trở thành phương pháp thẩm định chủ yếu tại các ngân hàng.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="xay-dung-mo-hinh-credit-scorecard">
<h1>6.2. Xây dựng mô hình credit scorecard<a class="headerlink" href="#xay-dung-mo-hinh-credit-scorecard" title="Permalink to this headline">¶</a></h1>
<p>Có nhiều thuật toán khác nhau được áp dụng để xây dựng mô hình scorecard. Trong bài này tôi sẽ chỉ giới thiệu mô hình thông dụng nhất đối với bài toán phân loại nợ xấu trong lớp các mô hình phân loại nhị phân, đó là hồi qui Logistic. Về hồi qui Logistic các bạn xem thêm tại <a class="reference external" href="https://phamdinhkhanh.github.io/deepai-book/ch_ml/classification.html">3.1. Logistic Regression</a> để nắm rõ nội dung của phương pháp này. Quá trình hồi qui sẽ tiếp nhận các đặc trưng đầu vào đã được tiền xử lý theo phương pháp <em>trọng số dấu hiệu</em>, viết tắt là WOE, cụ thể sẽ được giới thiệu bên dưới. Cuối cùng đầu ra của mô hình là xác suất vỡ nợ (<em>default probability</em>) đánh giá khả năng vỡ nợ của một hồ sơ vay vốn. Xác suất càng cao là dấu hiệu cho thấy khả năng vỡ nợ càng lớn. Từ xác suất, thông qua các phép biến đổi để chuyển sang điểm số tín nhiệm (<em>credit score</em>) đại diện cho mức độ uy tín của khách hàng. Điểm số này bằng tổng các điểm số tương ứng với mỗi một đặc trưng của người dùng được tạo ra từ WOE. Bạn đọc sẽ nắm rõ hơn điều này ở phần trình bày bên dưới.</p>
<div class="section" id="weight-of-evidence-woe">
<h2>6.2.1. Weight of Evidence - WOE<a class="headerlink" href="#weight-of-evidence-woe" title="Permalink to this headline">¶</a></h2>
<p>WOE (weight of evidence) là một trong những kĩ thuật <em>tạo đặc trưng</em> (<em>feature engineering</em>) và <em>lựa chọn đặc trưng</em> (<em>feature selection</em>) khá hiệu quả, thường được áp dụng trong quá trình xây dựng mô hình scorecard. Phương pháp này sẽ xếp hạng các biến thành mạnh, trung bình, yếu, không tác động,… dựa trên điểm số đánh giá về sức mạnh dự báo nợ xấu. Tiêu chuẩn xếp hạng sẽ là chỉ số giá trị thông tin IV (<em>information value</em>) được tính toán từ phương pháp WOE. Đồng thời mô hình cũng tạo ra các <em>đặc trưng</em> cho mỗi biến. Giá trị này sẽ đo lường sự khác biệt trong phân phối giữa GOOD và BAD. Cụ thể như sau:</p>
<p>Phương pháp WOE sẽ có các kĩ thuật xử lý khác biệt đối với biến liên tục và biến phân loại:</p>
<ul class="simple">
<li><p><strong>Trường hợp biến liên tục</strong>: WOE sẽ gán nhãn cho mỗi một quan sát theo nhãn giá trị bins mà nó thuộc về. Các bins sẽ là các khoảng liên tiếp được xác định từ biến liên tục sao cho số lượng quan sát ở mỗi bin là bằng nhau. Để xác định các bins thì ta cần xác định số lượng bins. Chúng ta có thể hình dung đầu mút của các khoảng bins chính là các quantile.</p></li>
<li><p><strong>Trường hợp biến phân loại</strong>: WOE có thể cân nhắc mỗi một nhóm là một bin hoặc có thể nhóm vài nhóm có số lượng quan sát ít vào một bin. Ngoài ra mức độ chênh lệch giữa phân phối GOOD/BAD được đo lường thông qua chỉ số WOE cũng có thể được sử dụng để nhận diện các nhóm có cùng tính chất phân loại. Nếu giá trị WOE của chúng càng gần nhau thì có thể chúng sẽ được nhóm vào một nhóm. Ngoài ra, trường hợp Null cũng có thể được coi là một nhóm riêng biệt nếu số lượng của nó là đáng kể hoặc nhóm vào các nhóm khác nếu nó là thiểu số.</p></li>
</ul>
<p>Để hình dung cách tính WOE, tôi lấy ví dụ:</p>
<p>Độ tuổi của một khách hàng vay vốn rơi vào khoảng từ 20-60 tuổi. Ta sẽ phân chia độ tuổi này thành các bins sao cho số lượng quan sát của chúng là gần bằng nhau và thống kê số lượng hồ sơ good và bad trên từng bin đó. Sau cùng ta thu được một bảng như bên dưới:</p>
<p><img alt="" src="https://i.imgur.com/rntYJSv.png" /></p>
<p><strong>Bảng 1</strong>: Bảng tính toán hệ số bằng chứng WOE và giá trị thông tin IV.</p>
<p>Các cột có ý nghĩa như sau:</p>
<ul class="simple">
<li><p><strong>No observation</strong>: Số lượng các quan sát trong từng bins. Thường sẽ được chia bằng nhau giữa các bins để không có sự thiên lệch.</p></li>
<li><p><strong>No Good</strong>: Số lượng hồ sơ là nợ xấu ở mỗi bins. Chúng ta coi những hồ sơ vỡ nợ là Good vì Good không phải đại diện cho chất lượng của hồ sơ mà chỉ đơn thuần đánh dấu các hồ sơ nhãn là 1.</p></li>
<li><p><strong>No Bad</strong>: Số lượng hồ sơ không là nợ xấu ở mỗi bins. Nhãn của hồ sơ là 0.</p></li>
<li><p><strong>Good/Bad</strong>: Tỷ lệ hồ sơ Good/Bad ở mỗi bins.</p></li>
<li><p><strong>%Good</strong>: Phân phối của các hồ sơ good trên toàn bộ các bins. Tổng cột bằng 1.</p></li>
<li><p><strong>%Bad</strong>: Phân phối của các hồ sơ bad trên toàn bộ các bins. Tương tự như %Good cũng có tổng bằng 1.</p></li>
<li><p><strong>WOE (Weight of Evidence)</strong>: Trọng số bằng chứng được sử dụng để đo lường sự khác biệt giữa tỷ lệ %Good và %Bad trên từng bin. Trọng số bằng chứng được tính toán bằng logarit của %Good/%Bad. Chẳng hạn tại bin 20-30 chúng ta biết được %Good = 0.313 và %Bad = 0.192, khi đó giá trị WOE tại bin này như sau:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\text{WOE}_{20-30} = \ln(\frac{\text{ %Good}}{\text{ %Bad}}) = \ln(\frac{0.313}{0.192}) = 0.491\]</div>
<p>Tính chất của WOE: Giá trị WOE tại một bin càng lớn là dấu hiệu chứng tỏ đặc trưng rất tốt trong việc nhận diện hồ sơ Good và trái lại nếu giá trị WOE càng nhỏ thì đặc trưng bin sẽ rất tốt trong việc nhận diện hồ sơ Bad. WOE &gt; 1 thì phân phối của hồ sơ Good đang chiếm ưu thế hơn Bad và trái lại.</p>
<ul class="simple">
<li><p><strong>IV (Information Value)</strong>: Chỉ số giá trị thông tin, có tác dụng đánh giá một biến có sức mạnh trong việc phân loại nợ xấu hay không. Công thức tính IV:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\sum_{i=1}^{n}({\text{ %Good}_{i}-\text{ %Bad}_{i}).\text{WOE}_{i}}\]</div>
<p>Ta nhận thấy IV luôn nhận giá trị dương vì <span class="math notranslate nohighlight">\(\text{WOE}_{i}\)</span> và <span class="math notranslate nohighlight">\((\text{ %Good}_{i}-\text{ %Bad}_{i})\)</span> đồng biến. Gía trị IV sẽ cho ta biết mức độ chênh lệch của <code class="docutils literal notranslate"><span class="pre">%Good</span></code> và <code class="docutils literal notranslate"><span class="pre">%Bad</span></code> ở mỗi bin là nhiều hay ít. Nếu IV cao thì sự khác biệt trong phân phối giữa <code class="docutils literal notranslate"><span class="pre">%Good</span></code> và <code class="docutils literal notranslate"><span class="pre">%Bad</span></code>sẽ lớn và biến hữu ích hơn trong việc phân loại hồ sơ và trái lại IV nhỏ thì biến ít hữu ích trong việc phân loại hồ sơ. Một số tài liệu cũng đưa ra tiêu chuẩn phân loại sức mạnh của biến theo giá trị IV như bên dưới:</p>
<ul class="simple">
<li><p>&lt;= 0.02: Biến không có tác dụng trong việc phân loại hồ sơ Good/Bad.</p></li>
<li><p>0.02 - 0.1: yếu</p></li>
<li><p>0.1 - 0.3: trung bình</p></li>
<li><p>0.3 - 0.5: mạnh</p></li>
<li><p>=&gt; 0.5: Biến rất mạnh, tuy nhiên trường hợp này cần được điều tra lại để tránh trường hợp biến có mối quan hệ trực tiếp để định nghĩa hồ sơ Good/Bad.</p></li>
</ul>
</div>
<div class="section" id="uu-va-nhuoc-diem-cua-phuong-phap-woe">
<h2>6.2.2. Ưu và nhược điểm của phương pháp WOE<a class="headerlink" href="#uu-va-nhuoc-diem-cua-phuong-phap-woe" title="Permalink to this headline">¶</a></h2>
<p>Sở dĩ các mô hình scorecard lại ưa chuộng WOE bởi vì chúng có những ưu điểm đó là:</p>
<ul class="simple">
<li><p>WOE giúp biến đổi các biến đầu vào liên tục thành những biến có mối quan hệ đơn điệu (đồng biến hoặc nghịch biến) đối với biến mục tiêu. Thật vậy, giả sử thống kê cho thấy đối với độ tuổi của khách hàng trong các khoảng <code class="docutils literal notranslate"><span class="pre">20-30,</span> <span class="pre">30-40,</span> <span class="pre">40-50,</span> <span class="pre">50+</span></code> thì tỷ lệ <em>%GOOD/%BAD</em> là <code class="docutils literal notranslate"><span class="pre">[0.1,</span> <span class="pre">0.5,</span> <span class="pre">0.2,</span> <span class="pre">0.3]</span></code>. Như vậy AGE sẽ không có mối quan hệ đồng biến với tỷ lệ <em>%GOOD/%BAD</em>, tức là nó không có mối quan hệ đồng biến với biến mục tiêu. Trong khi nếu hồi qui giá trị gốc của AGE theo Logistic thì mối quan hệ với biến mục tiêu của AGE sẽ là đơn điệu (đơn điệu tăng hay giảm phụ thuộc vào dấu của hệ số hồi qui). Điều này là trái với thực tế. Do đó, phương pháp WOE giúp ta chia nhỏ các biến liên tục thành các khoảng biến mà giá trị của nó là đơn điệu với biến mục tiêu tuỳ thuộc vào dấu của WOE tương ứng với mỗi khoảng. Do đó các hệ số trong phương trình hồi qui Logistic sẽ giải thích được đúng thực tế mối quan hệ giữa biến đầu vào với biến mục tiêu.</p></li>
<li><p>Phương pháp WOE giúp loại bỏ các outliers vì các biến có khoảng biến thiên lớn sẽ được nhóm về các nhóm bins. Gía trị của các quan sát outliers sẽ không còn khác biệt so với các những quan sát khác thuộc cùng nhóm vì chúng cùng được gán giá trị bằng trọng số WOE.</p></li>
<li><p>Giá trị WOE phản ánh được ảnh hưởng của từng nhóm lên biến phụ thuộc. Vì giá trị WOE thể hiện chênh lệch về tỷ lệ giữa <code class="docutils literal notranslate"><span class="pre">%GOOD/%BAD</span></code>, đây là chỉ số ảnh hưởng trực tiếp đến xác suất vỡ nợ của khách hàng.</p></li>
<li><p>Đối với các biến có nhiều nhóm nhỏ thì WOE sẽ nhóm chúng thành các nhóm lớn có hệ số WOE thể hiện thông tin chung cho toàn bộ nhóm.</p></li>
</ul>
<p>Chính nhờ những lợi thế trên mà WOE đã được sử dụng phổ biến trong các mô hình credit scorecard.</p>
<p>Tuy nhiên phương pháp WOE cũng có những hạn chế nhất định đó là:</p>
<ul class="simple">
<li><p>Khi tính toán WOE, rất khó để biết phân chia bao nhiêu bins là phù hợp đối với biến liên tục. Việc gộp nhóm hoặc tách nhóm cũng được thực hiện thủ công dựa trên phân tích giá trị của WOE.</p></li>
<li><p>Do các biến WOE là luôn đơn điệu với biến mục tiêu nên giữa các biến đầu vào luôn có sự tương quan (do cùng tương quan với biến mục tiêu). Điều này có thể dẫn đến nguy cơ đa cộng tuyến cao ảnh hưởng tới khả năng giải thích của hệ số hồi qui.</p></li>
</ul>
</div>
<div class="section" id="tieu-chuan-mo-hinh-scorecard">
<h2>6.2.3. Tiêu chuẩn mô hình scorecard<a class="headerlink" href="#tieu-chuan-mo-hinh-scorecard" title="Permalink to this headline">¶</a></h2>
<p>Vì là một mô hình liên quan đến định lượng tín nhiệm khách hàng và ảnh hưởng đến quyết định cấp vốn nên khi phát triển một mô hình scorecard và cân nhắc ứng dụng mô hình đó vào thực tiễn, ngân hàng cần phải xem xét đến các khía cạnh rủi ro có thể phát sinh để đảm bảo việc áp dụng mang lại hiệu quả và hạn chế các rủi ro tiềm ẩn. Các tiêu chuẩn cần đạt được của một mô hình credit scorecard đó là:</p>
<ul class="simple">
<li><p><strong>Khả năng diễn giải (Interpretability)</strong>: Một mô hình có khả năng diễn giải tốt sẽ dễ dàng áp dụng vào thực tiễn hơn so với các mô hình có khả năng diễn giải kém. Chẳng hạn khi áp dụng 2 thuật toán khác nhau là hồi qui Logistic và mạng Nơ ron vào xây dựng một mô hình phân loại nợ xấu thì mạng nơ ron có thể mặc dù mang lại kết quả tốt hơn nhưng mô hình hồi qui Logistic vẫn được ưa chuộng hơn vì nó có khả năng giải thích được tác động của các đặc trưng lên điểm số cuối cùng.</p></li>
<li><p><strong>Độ chính xác kì vọng (Expectation Accuracy)</strong>: Một mô hình trước khi đưa vào áp dụng cần phải đạt được một ngưỡng chính xác kì vọng. Ngưỡng chính xác này nên được thiết lập theo một thước đo phù hợp, chúng có thể là: <em>độ chính xác (Accuracy), độ chuẩn xác (Precision), độ phủ (Recall), f1 score, AUC, Gini, Kappa</em> giúp đánh giá bài toán phân loại. Thời điểm thiết lập kì vọng nên được tiến hành ở đầu dự án để tạo ra mục tiêu nhất quán trong suốt quá trình phát triển mô hình. Ngoài ra giá trị thiết lập nên được tham chiếu đến một số cơ sở thực tiễn chẳng hạn như: Khuyến nghị của các tổ chức tư vấn tài chính, độ chính xác mà một số ngân hàng khác đã đạt được trong cùng một thị trường, độ chính xác từ phương pháp chuyên gia,….</p></li>
<li><p><strong>Chi phí xây dựng (Cost)</strong>: Để xây dựng một mô hình scorecard sẽ khá tốn kém về mặt chi phí và nguồn lực. Đội ngũ phát triển sẽ phải bỏ công sức thu thập dữ liệu, xử lý dữ liệu, huấn luyện mô hình. Ngoài ra việc sử dụng một số nguồn dữ liệu ngoài như dữ liệu lịch sử tín dụng từ cục tín dụng sẽ phải mất phí. Quá trình xây dựng mô hình cần phải tuân theo chuẩn basel nên có thể sẽ cần tới chi phí thuê tư vấn từ bên thứ ba. Sau khi xây dựng mô hình sẽ phát sinh thêm các chi phí về hậu kiểm, vận hành và đánh giá lại mô hình định kì. Do đó cần ước tính chúng trước khi xây dựng mô hình để dự án đạt hiệu quả lớn nhất.</p></li>
</ul>
<p>Xây dựng mô hình scorecard là một quá trình lâu dài, từ khâu huấn luyện cho tới duy trì và vận hành. Đòi hỏi chúng ta phải thoả mãn các tiêu chuẩn chặt chẽ theo qui định của Basel. Trong khuôn khổ hạn hẹp, các nội dung liên quan tới tiêu chuẩn của Basel sẽ nằm ngoài bài viết này. Tiếp theo chúng ta sẽ cùng thực hành xây dựng một mô hình scorecard trên bộ dữ liệu <a class="reference external" href="http://www.creditriskanalytics.net/uploads/1/9/5/1/19511601/hmeq.csv">hmeq</a>.</p>
</div>
<div class="section" id="xay-dung-model-scorecard">
<h2>6.2.4.  Xây dựng model ScoreCard<a class="headerlink" href="#xay-dung-model-scorecard" title="Permalink to this headline">¶</a></h2>
<p>Sau đây chúng ta sẽ cùng xây dựng một model scorecard từ bộ dữ liệu <a class="reference external" href="http://www.creditriskanalytics.net/uploads/1/9/5/1/19511601/hmeq.csv">hmeq</a>. Thông tin cụ thể về các biến trong bộ dữ liệu này như sau:</p>
<p>Bộ dữ liệu HMEQ bao gồm các đặc trưng thông tin nợ quá hạn của 5960 khoản vay mua nhà. Đây là những khoản vay mà người vay sử dụng vốn chủ sở hữu làm tài sản thế chấp cơ sở. Tập dữ liệu bao gồm những trường sau:</p>
<ul class="simple">
<li><p>BAD: 1 = Hồ sơ vay là vi phạm hoặc mất khả năng trả nợ; 0 = hồ sơ vay đã và đang trả nợ.</p></li>
<li><p>LOAN: Số tiền yêu cầu cho vay.</p></li>
<li><p>MORTDUE: Số tiền đến hạn của khoản thế chấp hiện có.</p></li>
<li><p>VALUE: Giá trị tài sản hiện tại.</p></li>
<li><p>REASON: DebtCon = nợ hợp nhất; HomeImp = cải thiện nhà.</p></li>
<li><p>JOB: Thể loại nghề nghiệp.</p></li>
<li><p>YOJ: Số năm kinh nghiệm trong nghề nghiệp hiện tại.</p></li>
<li><p>DEROG: Số lượng báo cáo không tín nhiệm.</p></li>
<li><p>DELINQ: Số hạn mức tín dụng quá hạn.</p></li>
<li><p>CLAGE: Tuổi của hạn mức tín dụng cũ nhất tính theo tháng.</p></li>
<li><p>NINQ: Số câu hỏi tín dụng gần đây.</p></li>
<li><p>CLNO: Số lượng hạn mức tín dụng.</p></li>
<li><p>DEBTINC: Tỷ lệ nợ trên thu nhập.</p></li>
</ul>
<p>Có tổng cộng 12 biến đầu vào bao gồm cả biến numeric và biến category. Về cơ bản số lượng quan sát là đủ lớn để xây dựng mô hình credit scorecard. Tiếp theo chúng ta sẽ khảo sát dữ liệu.</p>
<div class="section" id="khao-sat-du-lieu">
<h3>6.2.4.1. Khảo sát dữ liệu<a class="headerlink" href="#khao-sat-du-lieu" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;http://www.creditriskanalytics.net/uploads/1/9/5/1/19511601/hmeq.csv&#39;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Khảo sát dữ liệu</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BAD</th>
      <th>LOAN</th>
      <th>MORTDUE</th>
      <th>VALUE</th>
      <th>YOJ</th>
      <th>DEROG</th>
      <th>DELINQ</th>
      <th>CLAGE</th>
      <th>NINQ</th>
      <th>CLNO</th>
      <th>DEBTINC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5960.000000</td>
      <td>5960.000000</td>
      <td>5442.000000</td>
      <td>5848.000000</td>
      <td>5445.000000</td>
      <td>5252.000000</td>
      <td>5380.000000</td>
      <td>5652.000000</td>
      <td>5450.000000</td>
      <td>5738.000000</td>
      <td>4693.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.199497</td>
      <td>18607.969799</td>
      <td>73760.817200</td>
      <td>101776.048741</td>
      <td>8.922268</td>
      <td>0.254570</td>
      <td>0.449442</td>
      <td>179.766275</td>
      <td>1.186055</td>
      <td>21.296096</td>
      <td>33.779915</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.399656</td>
      <td>11207.480417</td>
      <td>44457.609458</td>
      <td>57385.775334</td>
      <td>7.573982</td>
      <td>0.846047</td>
      <td>1.127266</td>
      <td>85.810092</td>
      <td>1.728675</td>
      <td>10.138933</td>
      <td>8.601746</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>1100.000000</td>
      <td>2063.000000</td>
      <td>8000.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.524499</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>11100.000000</td>
      <td>46276.000000</td>
      <td>66075.500000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>115.116702</td>
      <td>0.000000</td>
      <td>15.000000</td>
      <td>29.140031</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000</td>
      <td>16300.000000</td>
      <td>65019.000000</td>
      <td>89235.500000</td>
      <td>7.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>173.466667</td>
      <td>1.000000</td>
      <td>20.000000</td>
      <td>34.818262</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.000000</td>
      <td>23300.000000</td>
      <td>91488.000000</td>
      <td>119824.250000</td>
      <td>13.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>231.562278</td>
      <td>2.000000</td>
      <td>26.000000</td>
      <td>39.003141</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>89900.000000</td>
      <td>399550.000000</td>
      <td>855909.000000</td>
      <td>41.000000</td>
      <td>10.000000</td>
      <td>15.000000</td>
      <td>1168.233561</td>
      <td>17.000000</td>
      <td>71.000000</td>
      <td>203.312149</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>mean của BAD chính là tỷ lệ số hợp đồng nợ xấu và chiếm 19.95%. Ta sẽ visualize phân phối của các biến để tìm hiểu phân phối của chúng.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># Biểu đồ histogram</span>
<span class="k">def</span> <span class="nf">_plot_hist_subplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">use_kde</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
  <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> bins tickers&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>
  <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Count obs in </span><span class="si">{}</span><span class="s1"> each bin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;histogram plot of </span><span class="si">{}</span><span class="s1"> with </span><span class="si">{}</span><span class="s1"> bins&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
  <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">,</span> <span class="n">kde</span> <span class="o">=</span> <span class="n">use_kde</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Biểu đồ barchart</span>
<span class="k">def</span> <span class="nf">_plot_barchart_subplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">):</span>
  <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Group of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>
  <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Count obs in </span><span class="si">{}</span><span class="s1"> each bin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Barchart plot of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fieldname</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Missing&#39;</span><span class="p">)</span>
  <span class="n">df_summary</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
  <span class="n">y_values</span> <span class="o">=</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">values</span>
  <span class="n">x_index</span> <span class="o">=</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">index</span>
  <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">x_index</span><span class="p">)</span>
  <span class="c1"># Tạo vòng for lấy tọa độ đỉnh trên cùng của biểu đồ và thêm label thông qua annotate.</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">+</span><span class="mf">0.15</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Khởi tạo figure cho đồ thị (Kích thước W*H = 16x12) và cách nhau là 0.2 giữa các đồ thị</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># Tạo vòng for check định dạng của biến và visualize</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">fieldname</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
    <span class="n">ax_i</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">]:</span>
      <span class="n">ax_i</span> <span class="o">=</span> <span class="n">_plot_hist_subplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">fieldname</span><span class="p">],</span> <span class="n">fieldname</span><span class="o">=</span><span class="n">fieldname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ax_i</span> <span class="o">=</span> <span class="n">_plot_barchart_subplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">fieldname</span><span class="p">],</span> <span class="n">fieldname</span><span class="o">=</span><span class="n">fieldname</span><span class="p">)</span>
      
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Visualization all fields&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/creditScorecard_5_0.png" src="../_images/creditScorecard_5_0.png" />
</div>
</div>
<p>Nhận xét:</p>
<ul class="simple">
<li><p>Từ biểu đồ phân phối cho ta biết hình dạng phân phối của các biến.</p></li>
<li><p>Các outliers của các biến là những điểm nào?</p></li>
<li><p>Hình dạng phân phối cũng giúp ta phát hiện các dị thường trong dữ liệu. Chắc hẳn các bạn còn nhớ gian lận thi cử năm 2018 tại Sơn La và Hà Giang đã được phát hiện như thế nào?</p></li>
</ul>
</div>
<div class="section" id="ap-dung-phuong-phap-woe">
<h3>6.2.4.2. Áp dụng phương pháp WOE<a class="headerlink" href="#ap-dung-phuong-phap-woe" title="Permalink to this headline">¶</a></h3>
<p>Tiếp theo ta sẽ áp dụng phương pháp WOE vào việc xếp hạng sức mạnh dự báo của biến và tạo features cho mô hình. Nhưng trước đó sẽ cần phải xử lý dữ liệu missing data bằng giá trị trung bình.</p>
<p>Đối với biến numeric:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_num</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">data</span><span class="p">[</span><span class="n">columns_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">columns_num</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_obj</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">data</span><span class="p">[</span><span class="n">columns_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">columns_obj</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Missing&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Tính toán WOE cho từng biến</strong></p>
<p>Hàm _bin_table() bên dưới sẽ có tác dụng phân chia các nhóm bins và thống kê số lượng các quan sát, số lượng good và bad ở mỗi nhóm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">MAX_VAL</span> <span class="o">=</span> <span class="mi">999999999</span>
<span class="n">MIN_VAL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MAX_VAL</span>

<span class="k">def</span> <span class="nf">_bin_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">qcut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">colname</span><span class="p">,</span> <span class="s1">&#39;BAD&#39;</span><span class="p">]]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>
  <span class="n">coltype</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>

  <span class="k">if</span> <span class="n">coltype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">qcut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">bins</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Thay thế threshold đầu và cuối của thres</span>
        <span class="n">thres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MIN_VAL</span>
        <span class="n">thres</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAX_VAL</span>
        <span class="n">bins</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">thres</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bins</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n_bins must be lower to bin interval is valid!&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">bins</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">colname</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">qcut</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">X</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bins</span>
  <span class="k">elif</span> <span class="n">coltype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
    <span class="n">X</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>

  <span class="n">df_GB</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> 
                <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BAD&#39;</span><span class="p">],</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BAD&#39;</span><span class="p">],</span>
                <span class="n">aggfunc</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;BAD&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">size</span>
                <span class="p">})</span>

  <span class="n">df_Count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> 
                <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BAD&#39;</span><span class="p">],</span>
                <span class="n">aggfunc</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;BAD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span>
                <span class="p">})</span>
  
  <span class="k">if</span> <span class="n">coltype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">]:</span>
    <span class="n">df_Thres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Thres&#39;</span><span class="p">:</span><span class="n">thres</span><span class="p">[</span><span class="mi">1</span><span class="p">:]},</span> <span class="n">index</span><span class="o">=</span><span class="n">df_GB</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">coltype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
    <span class="n">df_Thres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df_GB</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">thres</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">df_Count</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;No_Obs&#39;</span><span class="p">]</span>
  <span class="n">df_GB</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#BAD&#39;</span><span class="p">,</span> <span class="s1">&#39;#GOOD&#39;</span><span class="p">]</span>
  <span class="n">df_summary</span> <span class="o">=</span> <span class="n">df_Thres</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_Count</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_GB</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">df_summary</span><span class="p">,</span> <span class="n">thres</span>
</pre></div>
</div>
</div>
</div>
<p>Phân chia các bins theo ngưỡng cutpoints. Phù hợp với những biến thứ bậc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_summary</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_bin_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;DELINQ&#39;</span><span class="p">,</span> <span class="n">qcut</span><span class="o">=</span><span class="p">[</span><span class="n">MIN_VAL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">MAX_VAL</span><span class="p">])</span>
<span class="n">df_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Thres</th>
      <th>No_Obs</th>
      <th>#BAD</th>
      <th>#GOOD</th>
    </tr>
    <tr>
      <th>bins</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(-999999999, 2]</th>
      <td>2</td>
      <td>5663</td>
      <td>4674</td>
      <td>989</td>
    </tr>
    <tr>
      <th>(2, 999999999]</th>
      <td>999999999</td>
      <td>297</td>
      <td>97</td>
      <td>200</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Phân chia các bins theo khai báo số lượng bins. Phù hợp với các biến liên tục.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_summary</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_bin_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;DEBTINC&#39;</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">df_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Thres</th>
      <th>No_Obs</th>
      <th>#BAD</th>
      <th>#GOOD</th>
    </tr>
    <tr>
      <th>bins</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(-999999999.0, 29.214]</th>
      <td>2.921447e+01</td>
      <td>1192</td>
      <td>1127</td>
      <td>65</td>
    </tr>
    <tr>
      <th>(29.214, 33.78]</th>
      <td>3.377992e+01</td>
      <td>2156</td>
      <td>1316</td>
      <td>840</td>
    </tr>
    <tr>
      <th>(33.78, 34.688]</th>
      <td>3.468780e+01</td>
      <td>228</td>
      <td>216</td>
      <td>12</td>
    </tr>
    <tr>
      <th>(34.688, 38.956]</th>
      <td>3.895595e+01</td>
      <td>1192</td>
      <td>1102</td>
      <td>90</td>
    </tr>
    <tr>
      <th>(38.956, 999999999.0]</th>
      <td>1.000000e+09</td>
      <td>1192</td>
      <td>1010</td>
      <td>182</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Tiếp theo hàm <code class="docutils literal notranslate"><span class="pre">_WOE()</span></code> sẽ tính toán các trọng số WOE ở mỗi bins và chỉ số IV cho từng biến. Trong trường hợp một bin có số lượng quan sát nhỏ hơn một ngưỡng tối thiểu ta sẽ ghép nó vào bin liền trước.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_WOE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_obs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">qcut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
  <span class="c1"># Thống kê bins và lấy ra thres hold ban đầu</span>
  <span class="n">df_summary</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_bin_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">qcut</span> <span class="o">=</span> <span class="n">qcut</span><span class="p">)</span>
  <span class="c1"># Thay thế giá trị 0 của #BAD trong df_summary bằng 1 để không bị lỗi chia cho 0</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#BAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#BAD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
  
  <span class="k">if</span> <span class="n">qcut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Lọc bỏ threshold để tạo thành threshold mới mà thỏa mãn số lượng quan sát &gt;= min_obs</span>
    <span class="n">exclude_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;No_Obs&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">min_obs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">exclude_ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">new_thres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">thres</span><span class="p">,</span> <span class="n">exclude_ind</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Auto combine </span><span class="si">{}</span><span class="s1"> bins into </span><span class="si">{}</span><span class="s1"> bins&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">new_thres</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
      <span class="c1"># Tính toán lại bảng summary</span>
      <span class="n">df_summary</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_bin_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">qcut</span><span class="o">=</span><span class="n">new_thres</span><span class="p">)</span>
  
  <span class="n">new_thres</span> <span class="o">=</span> <span class="n">thres</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;GOOD/BAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#GOOD&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#BAD&#39;</span><span class="p">]</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;%BAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#BAD&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#BAD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#GOOD&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;#GOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;WOE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;%BAD&#39;</span><span class="p">])</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;IV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;%BAD&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;WOE&#39;</span><span class="p">]</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;COLUMN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colname</span>
  <span class="n">IV</span> <span class="o">=</span> <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;IV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Information Value of </span><span class="si">{}</span><span class="s1"> column: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">IV</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">df_summary</span><span class="p">,</span> <span class="n">IV</span><span class="p">,</span> <span class="n">new_thres</span>

<span class="n">df_summary</span><span class="p">,</span> <span class="n">IV</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_WOE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;DEBTINC&#39;</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">min_obs</span><span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">df_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Information Value of DEBTINC column: 1.3795573580411762
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Thres</th>
      <th>No_Obs</th>
      <th>#BAD</th>
      <th>#GOOD</th>
      <th>GOOD/BAD</th>
      <th>%BAD</th>
      <th>%GOOD</th>
      <th>WOE</th>
      <th>IV</th>
      <th>COLUMN</th>
    </tr>
    <tr>
      <th>bins</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(-999999999.0, 27.028]</th>
      <td>2.702826e+01</td>
      <td>852</td>
      <td>800</td>
      <td>52</td>
      <td>0.065000</td>
      <td>0.167680</td>
      <td>0.043734</td>
      <td>-1.343925</td>
      <td>0.166573</td>
      <td>DEBTINC</td>
    </tr>
    <tr>
      <th>(27.028, 31.875]</th>
      <td>3.187511e+01</td>
      <td>851</td>
      <td>808</td>
      <td>43</td>
      <td>0.053218</td>
      <td>0.169357</td>
      <td>0.036165</td>
      <td>-1.543919</td>
      <td>0.205637</td>
      <td>DEBTINC</td>
    </tr>
    <tr>
      <th>(31.875, 33.78]</th>
      <td>3.377992e+01</td>
      <td>1645</td>
      <td>835</td>
      <td>810</td>
      <td>0.970060</td>
      <td>0.175016</td>
      <td>0.681245</td>
      <td>1.359046</td>
      <td>0.687988</td>
      <td>DEBTINC</td>
    </tr>
    <tr>
      <th>(33.78, 34.043]</th>
      <td>3.404341e+01</td>
      <td>58</td>
      <td>56</td>
      <td>2</td>
      <td>0.035714</td>
      <td>0.011738</td>
      <td>0.001682</td>
      <td>-1.942761</td>
      <td>0.019535</td>
      <td>DEBTINC</td>
    </tr>
    <tr>
      <th>(34.043, 37.18]</th>
      <td>3.717985e+01</td>
      <td>851</td>
      <td>783</td>
      <td>68</td>
      <td>0.086845</td>
      <td>0.164117</td>
      <td>0.057191</td>
      <td>-1.054182</td>
      <td>0.112719</td>
      <td>DEBTINC</td>
    </tr>
    <tr>
      <th>(37.18, 40.133]</th>
      <td>4.013282e+01</td>
      <td>851</td>
      <td>804</td>
      <td>47</td>
      <td>0.058458</td>
      <td>0.168518</td>
      <td>0.039529</td>
      <td>-1.450008</td>
      <td>0.187035</td>
      <td>DEBTINC</td>
    </tr>
    <tr>
      <th>(40.133, 999999999.0]</th>
      <td>1.000000e+09</td>
      <td>852</td>
      <td>685</td>
      <td>167</td>
      <td>0.243796</td>
      <td>0.143576</td>
      <td>0.140454</td>
      <td>-0.021982</td>
      <td>0.000069</td>
      <td>DEBTINC</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Vẽ biểu đồ giá trị WOE của các bins.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="n">df_summary</span><span class="p">):</span>
  <span class="n">colname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;COLUMN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;WOE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WOE of </span><span class="si">{}</span><span class="s1"> field&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colname</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;WOE&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bin group&#39;</span><span class="p">)</span>

<span class="n">_plot</span><span class="p">(</span><span class="n">df_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/creditScorecard_18_0.png" src="../_images/creditScorecard_18_0.png" />
</div>
</div>
<p>Tiếp theo ta sẽ tính toán giá trị WOE cho toàn bộ các biến.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Đối với các biến numeric</span>
<span class="n">WOE_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
<span class="n">nbins</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LOAN&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;MORTDUE&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;VALUE&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;YOJ&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;CLAGE&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;NINQ&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;CLNO&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;DEBTINC&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nbins</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="n">df_summary</span><span class="p">,</span> <span class="n">IV</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_WOE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
  <span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;table&#39;</span><span class="p">:</span><span class="n">df_summary</span><span class="p">,</span> <span class="s1">&#39;IV&#39;</span><span class="p">:</span><span class="n">IV</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Information Value of LOAN column: 0.1601563338988017
Information Value of MORTDUE column: 0.05131351983314017
Information Value of VALUE column: 0.14188912125986042
Information Value of YOJ column: 0.06714693781095009
Information Value of CLAGE column: 0.22171042878294653
Information Value of NINQ column: 0.06965935231976197
Information Value of CLNO column: 0.06043698467606807
Information Value of DEBTINC column: 1.3795573580411762
</pre></div>
</div>
</div>
</div>
<p>Do các biến <code class="docutils literal notranslate"><span class="pre">DEROG,</span> <span class="pre">DELINQ</span></code> có xu hướng là biến thứ bậc hơn là biến liên tục nên áp dụng cách phân chia theo quantile sẽ tạo ra những khoảng bins có độ dài bằng 0. Do đó chúng ta sẽ phân chia theo ngưỡng cutpoint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DEROG&#39;</span><span class="p">,</span> <span class="s1">&#39;DELINQ&#39;</span><span class="p">]:</span>
  <span class="n">df_summary</span><span class="p">,</span> <span class="n">IV</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_WOE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">qcut</span><span class="o">=</span><span class="p">[</span><span class="n">MIN_VAL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">MAX_VAL</span><span class="p">])</span>
  <span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;table&#39;</span><span class="p">:</span><span class="n">df_summary</span><span class="p">,</span> <span class="s1">&#39;IV&#39;</span><span class="p">:</span><span class="n">IV</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Information Value of DEROG column: 0.19008112833205368
Information Value of DELINQ column: 0.3366699247263777
</pre></div>
</div>
</div>
</div>
<p>Tiếp theo ta sẽ tính toán IV cho các biến category là <code class="docutils literal notranslate"><span class="pre">REASON</span></code> và <code class="docutils literal notranslate"><span class="pre">JOB</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;REASON&#39;</span><span class="p">,</span> <span class="s1">&#39;JOB&#39;</span><span class="p">]:</span>
  <span class="n">df_summary</span><span class="p">,</span> <span class="n">IV</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">_WOE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colname</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
  <span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;table&#39;</span><span class="p">:</span><span class="n">df_summary</span><span class="p">,</span> <span class="s1">&#39;IV&#39;</span><span class="p">:</span><span class="n">IV</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Information Value of REASON column: 0.008618460238864025
Information Value of JOB column: 0.1237305657142077
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="xep-hang-cac-bien-theo-suc-manh-du-bao">
<h3>6.2.4.3. Xếp hạng các biến theo sức mạnh dự báo<a class="headerlink" href="#xep-hang-cac-bien-theo-suc-manh-du-bao" title="Permalink to this headline">¶</a></h3>
<p>Dựa trên giá trị IV đã tính toán ở bước trước, ta sẽ xếp hạng các biến này như bên dưới.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">IVs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;BAD&#39;</span><span class="p">:</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">IVs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;IV&#39;</span><span class="p">])</span>
<span class="n">df_WOE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;IV&#39;</span><span class="p">:</span> <span class="n">IVs</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">_rank_IV</span><span class="p">(</span><span class="n">iv</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">iv</span> <span class="o">&lt;=</span> <span class="mf">0.02</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Useless&#39;</span>
  <span class="k">elif</span> <span class="n">iv</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Weak&#39;</span>
  <span class="k">elif</span> <span class="n">iv</span> <span class="o">&lt;=</span> <span class="mf">0.3</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Medium&#39;</span>
  <span class="k">elif</span> <span class="n">iv</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Strong&#39;</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Suspicious&#39;</span>

<span class="n">df_WOE</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_WOE</span><span class="p">[</span><span class="s1">&#39;IV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_rank_IV</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">df_WOE</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;IV&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>column</th>
      <th>IV</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11</th>
      <td>DEBTINC</td>
      <td>1.379557</td>
      <td>Suspicious</td>
    </tr>
    <tr>
      <th>7</th>
      <td>DELINQ</td>
      <td>0.336670</td>
      <td>Strong</td>
    </tr>
    <tr>
      <th>8</th>
      <td>CLAGE</td>
      <td>0.221710</td>
      <td>Medium</td>
    </tr>
    <tr>
      <th>6</th>
      <td>DEROG</td>
      <td>0.190081</td>
      <td>Medium</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LOAN</td>
      <td>0.160156</td>
      <td>Medium</td>
    </tr>
    <tr>
      <th>2</th>
      <td>VALUE</td>
      <td>0.141889</td>
      <td>Medium</td>
    </tr>
    <tr>
      <th>4</th>
      <td>JOB</td>
      <td>0.123731</td>
      <td>Medium</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NINQ</td>
      <td>0.069659</td>
      <td>Weak</td>
    </tr>
    <tr>
      <th>5</th>
      <td>YOJ</td>
      <td>0.067147</td>
      <td>Weak</td>
    </tr>
    <tr>
      <th>10</th>
      <td>CLNO</td>
      <td>0.060437</td>
      <td>Weak</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MORTDUE</td>
      <td>0.051314</td>
      <td>Weak</td>
    </tr>
    <tr>
      <th>3</th>
      <td>REASON</td>
      <td>0.008618</td>
      <td>Useless</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Như vậy trong các biến trên, biến <code class="docutils literal notranslate"><span class="pre">REASON</span></code> không có tác dụng trong việc phân loại hồ sơ nợ xấu. Các biến còn lại đều có tác dụng hỗ trợ một phần phân loại hồ sơ. Trong đó các biến có sức mạnh nhất là <code class="docutils literal notranslate"><span class="pre">DELINQ,</span> <span class="pre">DEBTINC</span></code>. Tiếp theo <code class="docutils literal notranslate"><span class="pre">CLAGE,</span> <span class="pre">DEROG,</span> <span class="pre">LOAN,</span> <span class="pre">VALUE,</span> <span class="pre">JOB</span></code> là các biến có sức mạnh trung bình. Các biến còn lại bao gồm <code class="docutils literal notranslate"><span class="pre">NINQ,</span> <span class="pre">YOJ,</span> <span class="pre">CLNO</span></code> và <code class="docutils literal notranslate"><span class="pre">MORTDUE</span></code> cũng có sức mạnh phân loại nhưng yếu hơn. <code class="docutils literal notranslate"><span class="pre">DELINQ</span></code> là biến có tương quan rất lớn đến việc phân loại nên chúng ta cần phải review lại giá trị của biến.</p>
</div>
<div class="section" id="hoi-qui-logistic">
<h3>6.2.4.4. Hồi qui logistic<a class="headerlink" href="#hoi-qui-logistic" title="Permalink to this headline">¶</a></h3>
<p>Phương trình hồi qui logistic trong credit scorecard sẽ không hồi qui trực tiếp trên các biến gốc mà thay vào đó giá trị WOE ở từng biến sẽ được sử dụng thay thế để làm đầu vào. Ta sẽ tính toán các biến WOE bằng cách map mỗi khoảng bin tương ứng với giá trị WOE của nó như sau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">WOE_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;table&#39;</span><span class="p">][</span><span class="s1">&#39;WOE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">woe</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;table&#39;</span><span class="p">][</span><span class="s1">&#39;WOE&#39;</span><span class="p">])</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">woe</span><span class="p">))</span>
    <span class="n">col_woe</span> <span class="o">=</span> <span class="n">col</span><span class="o">+</span><span class="s1">&#39;_WOE&#39;</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col_woe</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Gán giá trị input là các biến WOE và biến mục tiêu là data[‘BAD’].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;_WOE&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;BAD&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Phân chia tập huấn luyện/kiểm tra có tỷ lệ kích thước mẫu là 80:20. Tỷ lệ của GOOD/BAD là cân bằng trên cả tập huấn luyện và kiểm tra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">id_train</span><span class="p">,</span> <span class="n">id_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">123</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_train shape: &#39;</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_test shape: &#39;</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_train shape: &#39;</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_test shape: &#39;</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X_train shape:  (4768, 12)
X_test shape:  (1192, 12)
y_train shape:  (4768,)
y_test shape:  (1192,)
</pre></div>
</div>
</div>
</div>
<p>Xây dựng phương trình hồi qui logistic các biến đầu vào WOE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">logit_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">)</span>
<span class="n">logit_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LogisticRegression(C=1, max_iter=1000)
</pre></div>
</div>
</div>
</div>
<p>Dự báo và kiểm tra accuracy trên tập huấn luyện/kiểm tra</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="n">y_pred_train</span> <span class="o">=</span> <span class="n">logit_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">acc_train</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_pred_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">logit_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">acc_test</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_pred_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accuracy on train: &#39;</span><span class="p">,</span> <span class="n">acc_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accuracy on test: &#39;</span><span class="p">,</span> <span class="n">acc_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>accuracy on train:  0.8655620805369127
accuracy on test:  0.8557046979865772
</pre></div>
</div>
</div>
</div>
<p><strong>Đường cong ROC trên tập kiểm tra</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>

<span class="n">y_pred_prob_test</span> <span class="o">=</span> <span class="n">logit_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_prob_test</span><span class="p">)</span>
<span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_plot_roc_curve</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thres</span><span class="p">,</span> <span class="n">auc</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ROC curve (area = </span><span class="si">%0.2f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="k">auc</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC Curve&#39;</span><span class="p">)</span>

<span class="n">_plot_roc_curve</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thres</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_44490/1988037723.py:9: UserWarning: linestyle is redundantly defined by the &#39;linestyle&#39; keyword argument and the fmt string &quot;b-&quot; (-&gt; linestyle=&#39;-&#39;). The keyword argument will take precedence.
  plt.plot(fpr, tpr, &#39;b-&#39;, color=&#39;darkorange&#39;, lw=2, linestyle=&#39;--&#39;, label=&#39;ROC curve (area = %0.2f)&#39;%auc)
/tmp/ipykernel_44490/1988037723.py:9: UserWarning: color is redundantly defined by the &#39;color&#39; keyword argument and the fmt string &quot;b-&quot; (-&gt; color=&#39;b&#39;). The keyword argument will take precedence.
  plt.plot(fpr, tpr, &#39;b-&#39;, color=&#39;darkorange&#39;, lw=2, linestyle=&#39;--&#39;, label=&#39;ROC curve (area = %0.2f)&#39;%auc)
</pre></div>
</div>
<img alt="../_images/creditScorecard_38_1.png" src="../_images/creditScorecard_38_1.png" />
</div>
</div>
<p>Chỉ số AUC (<em>area under curve</em>) đo lường phần diện tích nằm dưới đường cong ROC cho biết khả năng phân loại của các hợp đồng <code class="docutils literal notranslate"><span class="pre">GOOD/BAD</span></code> của mô hình hồi qui Logistic là mạnh hay yếu. AUC <span class="math notranslate nohighlight">\(\in [0, 1]\)</span> , giá trị của nó càng lớn thì mô hình càng tốt. Đối với mô hình hồi qui Logistic này, AUC = 0.87 là khá cao, cho thấy khả năng dự báo của mô hình tốt và có thể áp dụng mô hình vào thực tiễn.</p>
<p><strong>Đường cong precision-recall trên tập kiểm tra</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span>
<span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thres</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_prob_test</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_plot_prec_rec_curve</span><span class="p">(</span><span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">thres</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thres</span><span class="p">,</span> <span class="n">prec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thres</span><span class="p">,</span> <span class="n">rec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Threshold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Precsion vs Recall Curve&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">_plot_prec_rec_curve</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thres</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/creditScorecard_40_0.png" src="../_images/creditScorecard_40_0.png" />
</div>
</div>
<p>Đường cong precision-recall cho chúng ta thấy sự đánh đổi qua lại giữa độ chuẩn xác (<em>precision</em>) và độ phủ (<em>recall</em>). Dựa trên kì vọng về <em>độ chuẩn xác</em> hoặc <em>độ phủ</em> từ trước chúng ta có thể lựa chọn được ngưỡng threshold phù hợp. Chẳng hạn trước khi bước vào dự án ta kì vọng tỷ lệ dự báo đúng hồ sơ GOOD là 70% thì cần thiết lập các threshold để giá trị recall &gt;= 70%. Trường hợp khác, ta kì vọng tỷ lệ dự báo đúng trong số các hồ sơ được dự báo là GOOD là 70% thì cần lựa chọn các threshold để giá trị precision &gt;= 70%. Rất khó để nói ngưỡng threshold nào nên được lựa chọn là tốt nhất. Điều này phụ thuộc vào mục tiêu của mô hình là ưu tiên phân loại đúng hồ sơ GOOD hay hồ sơ BAD hơn.</p>
<p><strong>Kiểm định Kolmogorov-Smirnov</strong></p>
<p>Đây là kiểm định về sự khác biệt trong phân phối giữa phân phối xác suất tích luỹ giữa <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code>. Nếu mô hình có khả năng phân loại <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code> tốt thì đường cong phân phối xác suất tích lũy (cumulative distribution function - cdf) giữa GOOD và BAD phải có sự khác biệt lớn. Trái lại, nếu mô hình rất yếu và kết quả dự báo của nó chỉ ngang bằng một phép lựa chọn ngẫu nhiên. Khi đó đường phân phối xác suất tích lũy của <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code> sẽ nằm sát nhau và tiệm cận đường chéo 45 độ. Kiểm định Kolmogorov-Smirnov sẽ kiểm tra giả thuyết <span class="math notranslate nohighlight">\(H_0\)</span> cho rằng hai phân phối xác suất giữa <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code> không có sự khác biệt. Khi P-value &lt; 0.05 bác bỏ giả thuyết <span class="math notranslate nohighlight">\(H_0\)</span>.</p>
<p>Tính toán phân phối xác suất tích lũy của <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_KM</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">):</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">cmd_BAD</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">cmd_GOOD</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">BAD_id</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_test</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">GOOD_id</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_test</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">total_BAD</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">BAD_id</span><span class="p">)</span>
  <span class="n">total_GOOD</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">GOOD_id</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">thres</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
    <span class="n">pred_id</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">&lt;=</span> <span class="n">thres</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Đếm % số lượng hồ sơ BAD có xác suất dự báo nhỏ hơn hoặc bằng thres</span>
    <span class="n">per_BAD</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_id</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">BAD_id</span><span class="p">))</span><span class="o">/</span><span class="n">total_BAD</span>
    <span class="n">cmd_BAD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per_BAD</span><span class="p">)</span>
    <span class="c1"># Đếm % số lượng hồ sơ GOOD có xác suất dự báo nhỏ hơn hoặc bằng thres</span>
    <span class="n">per_GOOD</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_id</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">GOOD_id</span><span class="p">))</span><span class="o">/</span><span class="n">total_GOOD</span>
    <span class="n">cmd_GOOD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per_GOOD</span><span class="p">)</span>
  <span class="n">cmd_BAD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cmd_BAD</span><span class="p">)</span>
  <span class="n">cmd_GOOD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cmd_GOOD</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">cmd_BAD</span><span class="p">,</span> <span class="n">cmd_GOOD</span><span class="p">,</span> <span class="n">thresholds</span>

<span class="n">cmd_BAD</span><span class="p">,</span> <span class="n">cmd_GOOD</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">_KM</span><span class="p">(</span><span class="n">y_pred_prob_test</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Biểu đồ phân phối xác suất tích lũy của <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_plot_KM</span><span class="p">(</span><span class="n">cmd_BAD</span><span class="p">,</span> <span class="n">cmd_GOOD</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">cmd_BAD</span><span class="p">,</span> <span class="s1">&#39;y-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;BAD&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">cmd_GOOD</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;GOOD&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">cmd_BAD</span><span class="o">-</span><span class="n">cmd_GOOD</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;DIFF&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">bservation&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% total GOOD/BAD&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Kolmogorov-Smirnov Curve&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">_plot_KM</span><span class="p">(</span><span class="n">cmd_BAD</span><span class="p">,</span> <span class="n">cmd_GOOD</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/creditScorecard_44_0.png" src="../_images/creditScorecard_44_0.png" />
</div>
</div>
<p>Kiểm định Kolmogorov-Smirnov:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">stats</span><span class="o">.</span><span class="n">ks_2samp</span><span class="p">(</span><span class="n">cmd_BAD</span><span class="p">,</span> <span class="n">cmd_GOOD</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KstestResult(statistic=0.5238095238095238, pvalue=0.005467427576534314)
</pre></div>
</div>
</div>
</div>
<p>p-value &lt; 0.05 cho thấy phân phối tích lũy giữa tỷ lệ <code class="docutils literal notranslate"><span class="pre">BAD</span></code> và <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> là khác biệt nhau. Do đó mô hình có ý nghĩa trong phân loại hồ sơ.</p>
</div>
<div class="section" id="tinh-diem-credit-score-cho-moi-dac-trung">
<h3>6.2.4.5. Tính điểm credit score cho mỗi đặc trưng<a class="headerlink" href="#tinh-diem-credit-score-cho-moi-dac-trung" title="Permalink to this headline">¶</a></h3>
<p>Bước cuối cùng là tính ra điểm tín nhiệm (credit scorecard) của mỗi khách hàng bằng cách tính điểm số cho mỗi đặc trưng (đặc trưng) ở đây là một khoảng bin của biến liên tục hoặc một nhãn của biến hạng mục). Điểm sẽ được scale theo công thức sau:</p>
<div class="math notranslate nohighlight">
\[\text{Score} = (\beta.\text{WOE}+\frac{\alpha}{n}).\text{Factor}+\frac{\text{Offset}}{n} \tag{1}\]</div>
<p>Trong đó:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta\)</span>: Hệ số của biến đặc trưng đầu vào trong phương trình hồi qui Logistic.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span>: Hệ số chặn của phương trình hồi qui Logistic.</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{WOE}\)</span>: Giá trị của biến đặc trưng đầu vào đã được gán bằng giá trị với WOE.</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span>: Số lượng các biến của mô hình.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\text{Factor}, \text{Offset}\)</span> Là các tham số được thiết lập để tính Score. Chúng được tính từ <span class="math notranslate nohighlight">\(\text{pdo}\)</span> và <span class="math notranslate nohighlight">\(\text{odd}\)</span> theo công thức:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{Factor} = \frac{\text{pdo}}{\ln(2)}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\text{Offset} = \text{Base_Score}-(\text{Factor}.\ln(\text{odd}))\)</span></p></li>
</ul>
<p><strong>Diễn giải ý nghĩa của Offset và Factor</strong></p>
<p>Như chúng ta đã biết, <span class="math notranslate nohighlight">\(\text{odd}\)</span> chính là tỷ lệ giữa xác suất GOOD/BAD.</p>
<p>Gỉa sử xác suất để hợp đồng là GOOD bằng <span class="math notranslate nohighlight">\(p\)</span> thì tỷ lệ:</p>
<div class="math notranslate nohighlight">
\[\text{odd} = \frac{p}{1-p}\]</div>
<p><span class="math notranslate nohighlight">\(p\)</span> được tính theo hàm Sigmoid. Nên giá trị:</p>
<div class="math notranslate nohighlight">
\[\ln(\text{odd}) = \ln{(\frac{p}{1-p})} = \ln{(e^{\beta \mathbf{x}})} = \beta \mathbf{x}\]</div>
<p>Nếu coi <span class="math notranslate nohighlight">\(\frac{\text{Offset}}{n}=C\)</span> là một hằng số. Như vậy phương trình (1) ta có thể viết thành:</p>
<div class="math notranslate nohighlight">
\[\text{Score} = (\ln(\text{odd})*\text{Factor}) + C\]</div>
<p>Lấy đạo hàm theo <span class="math notranslate nohighlight">\(\ln(\text{odd})\)</span>:</p>
<div class="math notranslate nohighlight">
\[\text{Factor} = \frac{d ~\text{Score}}{d ~\ln(\text{odd})}\]</div>
<p><strong>Ý nghĩa của Factor</strong>:</p>
<p>Gỉa sử với mức điểm cơ sở (<span class="math notranslate nohighlight">\(\text{Base_score}\)</span>) là <span class="math notranslate nohighlight">\(600\)</span> thì tỷ lệ odd ratio là <span class="math notranslate nohighlight">\(1:30\)</span>. Điểm càng cao thì hồ sơ càng tốt, do đó khi mức điểm giảm xuống còn <span class="math notranslate nohighlight">\(580\)</span> thì tỷ lệ hồ sơ xấu (nhãn <code class="docutils literal notranslate"><span class="pre">GOOD</span></code>) tăng lên và khiến cho tỷ lệ odd ratio tăng gấp đôi thành <span class="math notranslate nohighlight">\(1:15\)</span>. Chúng ta có thể hiểu <span class="math notranslate nohighlight">\(\text{pdo}\)</span> (<em>point double odd ratio</em>) chính là điểm thay đổi để gấp đôi tỷ lệ odd, giả sử chúng có giá trị bằng -20. Khi đó:</p>
<div class="math notranslate nohighlight">
\[\text{Factor} = \frac{d ~\text{Score}}{d ~\ln(\text{odd})} = \frac{\text{pdo}}{\ln(2)} \tag{2}\]</div>
<p>Như vậy <span class="math notranslate nohighlight">\(\text{Factor}\)</span> chính là tác động biên khi gia tăng odd ratio gấp đôi lên điểm số ứng với mỗi đặc trưng.</p>
<p><strong>Ý nghĩa của Offset</strong>:</p>
<p><span class="math notranslate nohighlight">\(\text{Offset}\)</span> có thể được xem như phần bù của điểm số để đạt được mức điểm <span class="math notranslate nohighlight">\(\text{Base_score}\)</span>.</p>
<p>Để hình dung rõ hơn quá trình tính điểm score chúng ta lấy ví dụ:</p>
<p>Một mô hình credit scorecard có các tham số thiết lập gồm tỷ lệ <span class="math notranslate nohighlight">\(\text{odd} = 1:50\)</span> tại <span class="math notranslate nohighlight">\(\text{Base_Score} =600\)</span> điểm và <span class="math notranslate nohighlight">\(\text{pdo}=20\)</span>, hai tham số <span class="math notranslate nohighlight">\(\text{Factor}, \text{Offset}\)</span> được tính như sau:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{Factor}=\frac{20}{\ln(2)}=28.85\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\text{Offset}=600-28.85\times \ln(1/50)=712.86\)</span></p></li>
</ul>
<p>Phương trình hồi qui có hệ số đối với 1 biến bất kì là <span class="math notranslate nohighlight">\(\beta = 0.5\)</span>, hệ số tự do <span class="math notranslate nohighlight">\(\alpha=1\)</span>, giá trị <span class="math notranslate nohighlight">\(\text{WOE}=0.15\)</span> và số lượng các biến <span class="math notranslate nohighlight">\(n=12\)</span>. Khi đó áp dụng phương trình (1) tính điểm tín nhiệm <span class="math notranslate nohighlight">\(\text{Score}\)</span> được đóng góp bởi biến đó sẽ là:</p>
<div class="math notranslate nohighlight">
\[\text{Score} = (0.5\times0.15+\frac{1}{12}).\text{28.85}+\frac{\text{712.85}}{12} = 63.97\]</div>
<p>Ta có thể tạo ra hàm số tính điểm cho mỗi đặc trưng như sau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">_CreditScore</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">woe</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">odds</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">pdo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="n">thres_score</span> <span class="o">=</span> <span class="mi">600</span><span class="p">):</span>
  <span class="n">factor</span> <span class="o">=</span> <span class="n">pdo</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">offset</span> <span class="o">=</span> <span class="n">thres_score</span> <span class="o">-</span> <span class="n">factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">odds</span><span class="p">)</span>
  <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">woe</span><span class="o">+</span><span class="n">alpha</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">factor</span><span class="o">+</span><span class="n">offset</span><span class="o">/</span><span class="n">n</span>
  <span class="k">return</span> <span class="n">score</span>

<span class="n">_CreditScore</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">woe</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42.2677896003704
</pre></div>
</div>
</div>
</div>
<p>Gán các giá trị <span class="math notranslate nohighlight">\(\beta\)</span> và <span class="math notranslate nohighlight">\(\alpha\)</span> vào dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">betas_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">logit_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">logit_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">betas_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;LOAN_WOE&#39;: 0.4710324107004053,
 &#39;MORTDUE_WOE&#39;: 0.5825609027920233,
 &#39;VALUE_WOE&#39;: 0.7543949126408708,
 &#39;YOJ_WOE&#39;: 0.883788791405289,
 &#39;CLAGE_WOE&#39;: 0.8622728924386148,
 &#39;NINQ_WOE&#39;: 0.5431039926781012,
 &#39;CLNO_WOE&#39;: 0.8543750687914761,
 &#39;DEBTINC_WOE&#39;: 0.9440898350669943,
 &#39;DEROG_WOE&#39;: 0.9016268860831372,
 &#39;DELINQ_WOE&#39;: 1.054952732547523,
 &#39;REASON_WOE&#39;: 0.6474770785463526,
 &#39;JOB_WOE&#39;: 0.8871024491457584}
</pre></div>
</div>
</div>
</div>
<p>Tính <code class="docutils literal notranslate"><span class="pre">WOE</span></code> cho từng đặc trưng.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">woes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">betas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">woe</span> <span class="ow">in</span> <span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;table&#39;</span><span class="p">][</span><span class="s1">&#39;WOE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
      <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
      <span class="c1"># Add feature</span>
      <span class="n">feature</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
      <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>    
      <span class="c1"># Add woe</span>
      <span class="n">woe</span> <span class="o">=</span> <span class="n">woe</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">woes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">woe</span><span class="p">)</span>
      <span class="c1"># Add beta</span>
      <span class="n">col_woe</span> <span class="o">=</span> <span class="n">col</span><span class="o">+</span><span class="s1">&#39;_WOE&#39;</span>
      <span class="n">beta</span> <span class="o">=</span> <span class="n">betas_dict</span><span class="p">[</span><span class="n">col_woe</span><span class="p">]</span>
      <span class="n">betas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
      <span class="c1"># Add score</span>
      <span class="n">score</span> <span class="o">=</span> <span class="n">_CreditScore</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">woe</span> <span class="o">=</span> <span class="n">woe</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
      <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

<span class="n">df_WOE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Columns&#39;</span><span class="p">:</span> <span class="n">cols</span><span class="p">,</span> <span class="s1">&#39;Features&#39;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s1">&#39;WOE&#39;</span><span class="p">:</span> <span class="n">woes</span><span class="p">,</span> <span class="s1">&#39;Betas&#39;</span><span class="p">:</span><span class="n">betas</span><span class="p">,</span> <span class="s1">&#39;Scores&#39;</span><span class="p">:</span><span class="n">scores</span><span class="p">})</span>
<span class="n">df_WOE</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Columns</th>
      <th>Features</th>
      <th>WOE</th>
      <th>Betas</th>
      <th>Scores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LOAN</td>
      <td>(-999999999.0, 7600.0]</td>
      <td>0.898910</td>
      <td>0.471032</td>
      <td>19.446581</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LOAN</td>
      <td>(7600.0, 10000.0]</td>
      <td>0.154566</td>
      <td>0.471032</td>
      <td>44.737736</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LOAN</td>
      <td>(10000.0, 12100.0]</td>
      <td>-0.112535</td>
      <td>0.471032</td>
      <td>53.813262</td>
    </tr>
    <tr>
      <th>3</th>
      <td>LOAN</td>
      <td>(12100.0, 14400.0]</td>
      <td>-0.158318</td>
      <td>0.471032</td>
      <td>55.368853</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LOAN</td>
      <td>(14400.0, 16300.0]</td>
      <td>0.162082</td>
      <td>0.471032</td>
      <td>44.482362</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Như vậy ta đã hoàn thiện bảng tính điểm số cho mỗi features. Từ điểm số này ta có thể suy ra điểm tín nhiệm của mỗi một hồ sơ bằng cách tính tổng điểm số của toàn bộ các features của hồ sơ đó. Bên dưới ta sẽ thực hành tính điểm tín nhiệm cho một hồ sơ ngẫu nhiên:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Giả sử một hồ sơ ngẫu nhiên có các thông số như sau</span>
<span class="n">test_obs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">test_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LOAN</th>
      <th>MORTDUE</th>
      <th>VALUE</th>
      <th>REASON</th>
      <th>JOB</th>
      <th>YOJ</th>
      <th>DEROG</th>
      <th>DELINQ</th>
      <th>CLAGE</th>
      <th>NINQ</th>
      <th>CLNO</th>
      <th>DEBTINC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1100</td>
      <td>25860.0</td>
      <td>39025.0</td>
      <td>HomeImp</td>
      <td>Other</td>
      <td>10.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>94.366667</td>
      <td>1.0</td>
      <td>9.0</td>
      <td>33.779915</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Viết hàm tính toán điểm số cho mỗi trường của một bộ hồ sơ:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_search_score</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
  <span class="n">feature</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span> <span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">WOE_dict</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">inter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">score</span> <span class="o">=</span> <span class="n">df_WOE</span><span class="p">[(</span><span class="n">df_WOE</span><span class="p">[</span><span class="s1">&#39;Columns&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_WOE</span><span class="p">[</span><span class="s1">&#39;Features&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature</span><span class="p">)][</span><span class="s1">&#39;Scores&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">score</span>

<span class="c1"># Tính điểm cho trường &#39;LOAN&#39; của bộ hồ sơ test</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">_search_score</span><span class="p">(</span><span class="n">test_obs</span><span class="p">,</span> <span class="s1">&#39;LOAN&#39;</span><span class="p">)</span>
<span class="n">score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19.446580780492287
</pre></div>
</div>
</div>
</div>
<p>Điểm chi tiết của từng trường trong bộ hồ sơ và điểm của toàn bộ bộ hồ sơ sẽ là:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_total_score</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">):</span>
  <span class="n">scores</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
    <span class="n">scores</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">_search_score</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
  <span class="n">total_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
  <span class="k">return</span> <span class="n">scores</span><span class="p">,</span> <span class="n">total_score</span>

<span class="n">scores</span><span class="p">,</span> <span class="n">total_score</span> <span class="o">=</span> <span class="n">_total_score</span><span class="p">(</span><span class="n">test_obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ta có thể tính toán điểm tín nhiệm cho toàn bộ các hồ sơ trên tập huấn luyện như sau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">data_test</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">id_test</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
  <span class="n">obs</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">:]</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">_total_score</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
  <span class="n">total_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

<span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_scores</span>
</pre></div>
</div>
</div>
</div>
<p>Biểu đồ phân phối của điểm số theo <code class="docutils literal notranslate"><span class="pre">GOOD</span></code> và <code class="docutils literal notranslate"><span class="pre">BAD</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;Score&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution Score of Total data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;BAD&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Score&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;BAD&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Score&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-Default&#39;</span><span class="p">,</span> 
             <span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">},</span> 
             <span class="n">hist_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution Score in Default vs Non-Default&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Distribution Score in Default vs Non-Default&#39;)
</pre></div>
</div>
<img alt="../_images/creditScorecard_62_1.png" src="../_images/creditScorecard_62_1.png" />
</div>
</div>
<p>Như vậy ta có thể nhận thấy phân phối điểm số của hồ sơ Default và Non-Default là khác biệt nhau. Điểm số tín nhiệm đánh giá mức độ tin cậy của khách hàng về khả năng trả nợ cho ngân hàng. Một khách hàng có điểm số tín nhiệm cao sẽ gia tăng mức độ tin tưởng của Ngân hàng dành cho họ. Ngoài ra Ngân hàng cũng có thể dựa trên điểm tín nhiệm để phân loại khách hàng thành những nhóm tiềm năng khác nhau giống như chỉ số <a class="reference external" href="https://www.experian.com/blogs/ask-experian/credit-education/score-basics/what-is-a-good-credit-score/">FICO score</a> đã phân loại:</p>
<p><img alt="" src="https://www.experian.com/blogs/ask-experian/wp-content/img/experian-good-score-ranges-fico.png" /></p>
<p><strong>Hình 1</strong>: Tỷ lệ phân chia các nhóm khách hàng theo ngưỡng điểm tín nhiệm.</p>
<p>Bên dưới là bảng thống kê đối với danh mục khách hàng vay vốn theo điểm scorecard.</p>
<a class="reference internal image-reference" href="https://i.imgur.com/xzt7Q3S.png"><img alt="https://i.imgur.com/xzt7Q3S.png" src="https://i.imgur.com/xzt7Q3S.png" style="width: 600px;" /></a>
<p><strong>Bảng 2</strong>: Bảng ảnh hưởng của các nhóm khách hàng theo điểm tín nhiệm.</p>
<p>Để giảm thiểu rủi ro thì Ngân hàng có thể đưa ra các điều kiện ràng buộc khi cho vay. Chẳng hạn như đối với khách hàng rơi vào nhóm <code class="docutils literal notranslate"><span class="pre">Very</span> <span class="pre">Poor</span></code>, Ngân hàng có thể đề nghị khách trả phí vay và tiền đặt cọc hoặc thậm chí là không cho vay với nhóm khách hàng này.</p>
</div>
</div>
<div class="section" id="ket-luan">
<h2>6.3. Kết luận<a class="headerlink" href="#ket-luan" title="Permalink to this headline">¶</a></h2>
<p>Như vậy tôi đã giới thiệu tới các bạn các bước để xây dựng một mô hình credit scorecard từ các bước như thu thập dữ liệu, tiền xử lý dữ liệu bằng phương pháp WOE, hồi qui mô hình, hậu kiểm mô hình, dự báo xác suất, tính toán điểm tín nhiệm cho một hồ sơ. Về cơ bản phương pháp scorecard là khá đơn giản. Tuy nhiên quá trình xây dựng mô hình đòi hỏi phải đáp ứng được rất nhiều tiêu chí như khả năng giải thích, độ chính xác, chi phí xây dựng, khả năng áp dụng vào thực tiễn. Điều này đòi hỏi chúng ta phải bỏ ra nhiều công sức hơn để huấn luyện và cải tiến mô hình scorecard.</p>
<p>Bên cạnh đó, ngoài áp dụng trong lĩnh vực quản trị rủi ro tín dụng, mô hình scorecard còn có thể mở rộng và áp dụng sang rất nhiều các lĩnh vực khác như thẩm định khách hàng trên các nền tảng cho vay online, xếp hạng khách hàng trong marketing, xếp hạng doanh nghiệp, xếp hạng quốc gia, tổ chức tài chính,…</p>
</div>
<div class="section" id="bai-tap">
<h2>6.4. Bài tập<a class="headerlink" href="#bai-tap" title="Permalink to this headline">¶</a></h2>
<p>Sử dụng bộ dữ liệu về <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Iranian+Churn+Dataset">churn customer</a>. Hãy thực hiện các công việc sau.</p>
<ol class="simple">
<li><p>Khảo sát dữ liệu đầu vào.</p></li>
<li><p>Phân chia hai tập huấn luyện và kiểm tra theo tỷ lệ 80:20.</p></li>
<li><p>Tính toán chỉ số WOE trên từng biến và xếp hạng sức mạnh phân loại của từng biến.</p></li>
<li><p>Xây dựng mô hình scorecard trên tập huấn luyện.</p></li>
<li><p>Chấm điểm khách hàng rời bỏ trên tập kiểm tra.</p></li>
<li><p>Đánh giá sự khác biệt về phân phối giữa hai xác suất luỹ kế giữa GOOD và BAD.</p></li>
</ol>
</div>
<div class="section" id="tai-lieu-tham-khao">
<h2>6.5. Tài liệu tham khảo<a class="headerlink" href="#tai-lieu-tham-khao" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="https://www.experian.com/blogs/ask-experian/credit-education/score-basics/what-is-a-good-credit-score/">FICO score</a></p></li>
<li><p><a class="reference external" href="https://multithreaded.stitchfix.com/blog/2015/08/13/weight-of-evidence/">WOE - Weight of Evidence</a></p></li>
<li><p><a class="reference external" href="https://rpubs.com/chidungkt/442168">Scorecard model - Nguyen Chi Dung VietNam</a></p></li>
<li><p><a class="reference external" href="https://rstudio-pubs-static.s3.amazonaws.com/441239_e4a46ef90bd5421bb810e95c06f22df8.html#introduction_to_credit_scoring_and_scorecard_approach">Introduction to credit scoring and scorecard approach - Jenny Nguyen</a></p></li>
<li><p><a class="reference external" href="https://rpubs.com/chidungkt/442168">Introduction to credit scoring and scorecard approach- Nguyen Chi Dung VietNam</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/attribute-relevance-analysis-in-python-iv-and-woe-b5651443fc04">Attribute relevance analysis in python IV and WOE - R language</a></p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/scorecard/scorecard.pdf">Scorecard package in R language</a></p></li>
<li><p><a class="reference external" href="https://pypi.org/project/scorecardpy/">Scorecard package in python</a></p></li>
<li><p><a class="reference external" href="https://www.investopedia.com/terms/c/credit-worthiness.asp">Creditworthiness - investopedia</a></p></li>
<li><p><a class="reference external" href="https://www.amazon.com/Credit-Risk-Scorecards-Implementing-Intelligent/dp/047175451X">Credit Risk Scorecards Implementing Intelligent - Naeem Siddiqui</a></p></li>
<li><p><a class="reference external" href="https://www.researchgate.net/publication/332098964_Credit_Scoring_Application_at_Banks_Mapping_to_Basel_II">Credit Scoring Application at Banks: Mapping to Basel II - Do Hoai Linh, Luong Thi Thu Hang, Nguyen Xuan Thang - NEU University VietNam</a></p></li>
<li><p><a class="reference external" href="https://epub.uni-regensburg.de/8241/1/hamerle1.pdf">Credit Risk Factor Modeling and the Basel II IRB Approach</a></p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ch_ml"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index_creditScorecard.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">6. Ứng dụng mô hình scorecard</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="index_SVM.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">7. Giới thiệu về SVM</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Pham Dinh Khanh<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>